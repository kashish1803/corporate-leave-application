<div class="main-content">
  <div class="container-fluid">
    
    <div class="row mb-4" *ngIf="!selectedEmployee">
        <div class="col-md-12">
            <div class="card card-nav-tabs card-plain">
                <div class="card-header card-header-white"> 
                    <div class="nav-tabs-navigation">
                        <div class="nav-tabs-wrapper">
                            <ul class="nav nav-tabs" data-tabs="tabs">
                                <li class="nav-item">
                                    <a class="nav-link tab-purple" [class.active]="activeTab === 'calendar'" (click)="switchTab('calendar')" href="javascript:void(0)">
                                        <span class="d-flex align-items-center justify-content-center">
                                            <i class="material-icons mr-2">calendar_month</i> 
                                            <span class="tab-text">Team Leave Calendar</span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link tab-green" [class.active]="activeTab === 'team'" (click)="switchTab('team')" href="javascript:void(0)">
                                        <span class="d-flex align-items-center justify-content-center">
                                            <i class="material-icons mr-2">people</i> 
                                            <span class="tab-text">View Team List</span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
      <div class="col-md-12" *ngIf="activeTab === 'calendar' && !selectedEmployee">
          <div class="card">
              <div class="card-header card-header-primary">
                  <h4 class="card-title">Monthly Leave Overview</h4>
                  <p class="card-category">Track absences and manage reports</p>
              </div>
              <div class="card-body">
                  <div class="row mb-4 align-items-center report-container">
                      <div class="col-md-3">
                          <mat-form-field class="w-100">
                              <mat-label>Report Month</mat-label>
                              <mat-select [(ngModel)]="reportMonth">
                                  <mat-option *ngFor="let m of months" [value]="m.val">{{ m.name }}</mat-option>
                              </mat-select>
                          </mat-form-field>
                      </div>
                      <div class="col-md-2">
                          <mat-form-field class="w-100">
                              <mat-label>Year</mat-label>
                              <input matInput type="number" [(ngModel)]="reportYear">
                          </mat-form-field>
                      </div>
                      <div class="col-md-7">
                        <button class="btn btn-primary btn-sm mr-2" (click)="downloadTeamReport()">
                            <i class="material-icons">cloud_download</i> Download Report
                        </button>
                        <button class="btn btn-info btn-sm" (click)="sendReportToEmail()">
                            <i class="material-icons">email</i> Email Report
                        </button>
                      </div>
                  </div>

                  <div class="row mb-3 align-items-center">
                      <div class="col-md-12 text-center">
                          <div class="calendar-nav-wrapper">
                              <button class="btn btn-link btn-sm btn-primary p-0" (click)="changeTeamCalendarMonth(-1)">
                                  <i class="material-icons">chevron_left</i>
                              </button>
                              <span class="month-label">{{ teamCalendarDate | date:'MMMM yyyy' }}</span>
                              <button class="btn btn-link btn-sm btn-primary p-0" (click)="changeTeamCalendarMonth(1)">
                                  <i class="material-icons">chevron_right</i>
                              </button>
                          </div>
                      </div>
                  </div>

                  <div class="team-calendar-grid">
                      <div class="calendar-header purple-header" *ngFor="let day of weekDays">{{ day }}</div>
                      <div class="calendar-cell" *ngFor="let day of calendarDays" 
                            [ngClass]="{'empty-cell': !day.date, 'has-leaves': day.leaves && day.leaves.length > 0}">
                          <div class="date-number" *ngIf="day.date">{{ day.date }}</div>
                          <div class="leave-list" *ngIf="day.date">
                              <div *ngFor="let leave of day.leaves" 
                                   class="badge mb-1 w-100 text-left leave-item" 
                                   [ngClass]="{
                                      'status-leave': leave.status === 'LEAVE',
                                      'status-halfday': leave.status === 'HALF_DAY',
                                      'status-holiday': leave.status === 'HOLIDAY'
                                   }"
                                   (click)="viewAttendanceByName(leave.name)">
                                  {{ leave.name }} ({{ leave.status }})
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      
      <div class="col-md-12" *ngIf="activeTab === 'team' && !selectedEmployee">
        <div class="card">
            <div class="card-header card-header-success">
                <h4 class="card-title">My Team Details</h4>
                <p class="card-category">View employee profiles and manage history</p>
            </div>
            <div class="card-body table-responsive">
                <table class="table table-hover">
                    <thead class="text-success">
                        <th>Emp ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th class="text-right">Actions</th>
                    </thead>
                    <tbody>
                        <tr *ngFor="let emp of myTeam">
                            <td>{{ emp.employeeId }}</td>
                            <td>{{ emp.firstName }} {{ emp.lastName }}</td>
                            <td>{{ emp.projectEmailId || emp.email }}</td>
                            <td class="td-actions text-right">
                                <button mat-raised-button type="button" 
                                        class="btn btn-info btn-link btn-sm"
                                        (click)="viewAttendance(emp)"
                                        matTooltip="View and Edit History">
                                    <i class="material-icons">visibility</i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
      </div>
      
      <div class="col-md-12" *ngIf="selectedEmployee">
          <button class="btn btn-sm btn-default mb-3" (click)="closeView()">
            <i class="material-icons">arrow_back</i> Back to Team
          </button>
          <div class="card">
              <div class="card-header card-header-info">
                  <h4 class="card-title">Attendance Details: {{ selectedEmployee.firstName }} {{ selectedEmployee.lastName }}</h4>
              </div>
              <div class="card-body">
                   <app-calendar [targetEmployee]="selectedEmployee.employeeId"></app-calendar>
              </div>
          </div>
      </div>
    </div>
  </div>
</div>

<style>
/* TABS STYLING */
.nav-tabs .nav-link { font-weight: 500; cursor: pointer; border-radius: 3px; margin-right: 5px; transition: all 0.3s; border: 1px solid #ddd; padding: 10px 15px; background: #ffffff !important; }

/* Icon Fix */
.nav-tabs .nav-link i { vertical-align: middle; margin-right: 8px; font-size: 20px; }

/* Active Tab Visibility Fixes */
.nav-link.tab-purple.active { 
    color: #ffffff !important; 
    background: linear-gradient(60deg, #ab47bc, #8e24aa) !important; 
    box-shadow: 0 4px 20px 0px rgba(0,0,0,0.14), 0 7px 10px -5px rgba(156,39,176,0.4) !important; 
}
.nav-link.tab-purple.active i, .nav-link.tab-purple.active .tab-text { color: #ffffff !important; }

.nav-link.tab-green.active { 
    color: #ffffff !important; 
    background: linear-gradient(60deg, #66bb6a, #43a047) !important; 
    box-shadow: 0 4px 20px 0px rgba(0,0,0,0.14), 0 7px 10px -5px rgba(76,175,80,0.4) !important; 
}
.nav-link.tab-green.active i, .nav-link.tab-green.active .tab-text { color: #ffffff !important; }

/* Status Colors */
.status-leave { background-color: #f44336 !important; color: white !important; }
.status-halfday { background-color: #ff9800 !important; color: white !important; }
.status-holiday { background-color: #2196f3 !important; color: white !important; }
.status-present { background-color: #4caf50 !important; color: white !important; }

/* General Calendar Styles */
.calendar-nav-wrapper { background: #fff; padding: 5px 20px; border-radius: 30px; display: inline-flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid #e0e0e0; }
.month-label { font-weight: bold; color: #333; font-size: 1.1em; min-width: 160px; text-align: center; }
.team-calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; border: 1px solid #ddd; background: #ddd; border-radius: 4px; overflow: hidden; }
.calendar-header.purple-header { background: #8e24aa; color: #fff; font-weight: bold; text-align: center; padding: 12px 0; font-size: 0.9em; text-transform: uppercase; }
.calendar-cell { background: #fff; height: 140px; padding: 8px; display: flex; flex-direction: column; position: relative; }
</style>