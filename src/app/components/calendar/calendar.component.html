<div class="calendar-wrapper">
    <div class="calendar-bar-header">
        <div class="bar-content">
            <button mat-icon-button (click)="changeMonth(-1)" class="nav-btn">
                <i class="material-icons">chevron_left</i>
            </button>
            
            <h3 class="current-month-display">{{ monthLabel }}</h3>
            
            <button mat-icon-button (click)="changeMonth(1)" class="nav-btn">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>

    <div class="calendar-grid">
        <div class="cal-header-cell" *ngFor="let day of weekDays">{{ day }}</div>

        <div class="cal-cell" 
             *ngFor="let day of calendarDays"
             [ngClass]="{'empty': !day.date, 'weekend': day.isWeekend}">
            
            <ng-container *ngIf="day.date">
                <div class="date-header">
                    <div class="date-num">{{ day.date }}</div>
                    
                    <button *ngIf="!day.isLocked" 
                            mat-icon-button 
                            [matMenuTriggerFor]="appMenu" 
                            class="menu-btn" 
                            (click)="$event.stopPropagation()">
                        <i class="material-icons" style="font-size: 16px; line-height: 16px;">more_vert</i>
                    </button>
                </div>
                
                <div class="leaves-container" *ngIf="day.leaves && day.leaves.length > 0">
                    <ng-container *ngFor="let leave of day.leaves">
                        <div *ngIf="leave.status?.toUpperCase() !== 'PRESENT'" 
                             class="status-badge"
                             [ngClass]="{
                                 'leave': leave.status?.toUpperCase() === 'LEAVE',
                                 'half-day': leave.status?.toUpperCase() === 'HALF_DAY',
                                 'holiday': leave.status?.toUpperCase() === 'HOLIDAY'
                             }">
                            <span class="badge-text">{{ leave.status?.replace('_', ' ') }}</span>
                        </div>
                    </ng-container>
                </div>

                <mat-menu #appMenu="matMenu">
                    <button mat-menu-item (click)="applyAction(day, 'Leave')">
                        <mat-icon class="text-danger">block</mat-icon> Full Day Leave
                    </button>
                    <button mat-menu-item (click)="applyAction(day, 'Half Day')">
                        <mat-icon class="text-warning">timelapse</mat-icon> Half Day
                    </button>
                    <button mat-menu-item (click)="applyAction(day, 'Optional Holiday')">
                        <mat-icon class="text-success">beach_access</mat-icon> Holiday
                    </button>
                    
                    <ng-container *ngIf="day.leaves && day.leaves.length > 0">
                        <mat-divider></mat-divider>
                        <button mat-menu-item (click)="applyAction(day, 'Cancel')">
                            <mat-icon>close</mat-icon> Withdraw / Reset
                        </button>
                    </ng-container>
                </mat-menu>
            </ng-container>
        </div>
    </div>
</div>